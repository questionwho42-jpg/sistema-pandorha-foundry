<form class="pandorha-sheet" data-actor-id="{{actor.id}}" autocomplete="off">
  <header class="sheet-header">
    <div class="header-main">
      <input class="name" name="name" type="text" value="{{actor.name}}" />
      <div class="subline">
        <label>Nível</label>
        <input name="system.attributes.level" type="number" value="{{system.attributes.level}}" />
        <label>Ancestralidade</label>
        <input name="system.details.ancestry" type="text" value="{{system.details.ancestry}}" />
        <label>Classe</label>
        <input name="system.details.class" type="text" value="{{system.details.class}}" />
        <label>Antecedente</label>
        <input name="system.details.background" type="text" value="{{system.details.background}}" />
      </div>
    </div>
  </header>

  <nav class="pandorha-tabs" aria-label="Abas da Ficha">
    <input type="radio" name="pandorha-tab" id="tab-base" data-action="switch-tab" data-tab="base" {{#ifEq activeTab "base"}}checked{{/ifEq}} />
    <label for="tab-base" data-action="switch-tab" data-tab="base">Base</label>

    <input type="radio" name="pandorha-tab" id="tab-origem" data-action="switch-tab" data-tab="origem" {{#ifEq activeTab "origem"}}checked{{/ifEq}} />
    <label for="tab-origem" data-action="switch-tab" data-tab="origem">Origem</label>

    {{#if isCharacter}}
    <input type="radio" name="pandorha-tab" id="tab-criacao" data-action="switch-tab" data-tab="criacao" {{#ifEq activeTab "criacao"}}checked{{/ifEq}} />
    <label for="tab-criacao" data-action="switch-tab" data-tab="criacao">Criacao</label>
    {{/if}}

    <input type="radio" name="pandorha-tab" id="tab-pericias" data-action="switch-tab" data-tab="pericias" {{#ifEq activeTab "pericias"}}checked{{/ifEq}} />
    <label for="tab-pericias" data-action="switch-tab" data-tab="pericias">Perícias</label>

    <input type="radio" name="pandorha-tab" id="tab-itens" data-action="switch-tab" data-tab="itens" {{#ifEq activeTab "itens"}}checked{{/ifEq}} />
    <label for="tab-itens" data-action="switch-tab" data-tab="itens">Itens</label>

    <input type="radio" name="pandorha-tab" id="tab-tracos" data-action="switch-tab" data-tab="tracos" {{#ifEq activeTab "tracos"}}checked{{/ifEq}} />
    <label for="tab-tracos" data-action="switch-tab" data-tab="tracos">Traços</label>

    <input type="radio" name="pandorha-tab" id="tab-status" data-action="switch-tab" data-tab="status" {{#ifEq activeTab "status"}}checked{{/ifEq}} />
    <label for="tab-status" data-action="switch-tab" data-tab="status">Condições</label>

    {{#if isMonster}}
    <input type="radio" name="pandorha-tab" id="tab-monstro" data-action="switch-tab" data-tab="monstro" {{#ifEq activeTab "monstro"}}checked{{/ifEq}} />
    <label for="tab-monstro" data-action="switch-tab" data-tab="monstro">Monstro</label>
    {{/if}}

    <input type="radio" name="pandorha-tab" id="tab-descricao" data-action="switch-tab" data-tab="descricao" {{#ifEq activeTab "descricao"}}checked{{/ifEq}} />
    <label for="tab-descricao" data-action="switch-tab" data-tab="descricao">Descrição</label>

    <div class="tab-content">
      <div class="tab-panel tab-base">
        <section class="grid">
          <div class="panel">
            <h3>Eixos</h3>
            <div class="stats">
              <label>Físico</label>
              <input name="system.eixos.fisico" type="number" value="{{system.eixos.fisico}}" />
              <label>Mental</label>
              <input name="system.eixos.mental" type="number" value="{{system.eixos.mental}}" />
              <label>Social</label>
              <input name="system.eixos.social" type="number" value="{{system.eixos.social}}" />
            </div>
          </div>

          <div class="panel">
            <h3>Aplicações</h3>
            <div class="stats">
              <label>Conflito</label>
              <input name="system.aplicacoes.conflito" type="number" value="{{system.aplicacoes.conflito}}" />
              <label>Interação</label>
              <input name="system.aplicacoes.interacao" type="number" value="{{system.aplicacoes.interacao}}" />
              <label>Resistência</label>
              <input name="system.aplicacoes.resistencia" type="number" value="{{system.aplicacoes.resistencia}}" />
            </div>
          </div>

          <div class="panel">
            <h3>Recursos</h3>
            <div class="stats">
              <label>HP</label>
              <input name="system.resources.hp.value" type="number" value="{{system.resources.hp.value}}" />
              <span>/</span>
              <input name="system.resources.hp.max" type="number" value="{{system.resources.hp.max}}" />

              <label>PV</label>
              <input name="system.resources.pv.value" type="number" value="{{system.resources.pv.value}}" />
              <span>/</span>
              <input name="system.resources.pv.max" type="number" value="{{system.resources.pv.max}}" />

              <label>EE</label>
              <input name="system.resources.ee.value" type="number" value="{{system.resources.ee.value}}" />
              <span>/</span>
              <input name="system.resources.ee.max" type="number" value="{{system.resources.ee.max}}" />
            </div>
            <div class="stats">
              <label>CA</label>
              <input name="system.defenses.ca" type="number" value="{{system.defenses.ca}}" />
              <label>Mov</label>
              <input name="system.movement.base" type="number" value="{{system.movement.base}}" />
            </div>
          </div>

          <div class="panel">
            <h3>Rolagem</h3>
            <div class="roll-row">
              <select name="roll-eixo">
                <option value="fisico">Físico</option>
                <option value="mental">Mental</option>
                <option value="social">Social</option>
              </select>
              <select name="roll-aplicacao">
                <option value="conflito">Conflito</option>
                <option value="interacao">Interação</option>
                <option value="resistencia">Resistência</option>
              </select>
              <input name="roll-bonus" type="number" value="0" />
              <select name="roll-map">
                <option value="auto">MAP Auto</option>
                <option value="0">MAP 0</option>
                <option value="1">MAP 1</option>
                <option value="2">MAP 2</option>
              </select>
              <label class="inline">Treinado
                <input name="roll-trained" type="checkbox" checked />
              </label>
              <button type="button" data-action="roll-test">Rolar</button>
            </div>
            <div class="derived">
              <div>Iniciativa base: {{system.derived.initiative}}</div>
              <div>Slots usados: {{system.derived.carrySlots}} / {{system.derived.carryMax}}</div>
              <div>Tier: {{system.attributes.tier}}</div>
              <div>DC Mundana: {{system.derived.dcTable.mundana}} | Desafiadora: {{system.derived.dcTable.desafiadora}} | Lendária: {{system.derived.dcTable.lendaria}} | Divina: {{system.derived.dcTable.divina}}</div>
            </div>
          </div>
        </section>
      </div>

      <div class="tab-panel tab-origem">
        <section class="panel">
          <h3>Origem</h3>
          <div class="item-list">
            <div class="item-row">
              <span class="item-name">Ancestralidade: {{system.details.ancestry}}</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.ancestries">Abrir Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.ancestries" data-item-type="ancestry">Adicionar</button>
              </div>
            </div>
            <div class="item-row">
              <span class="item-name">Antecedente: {{system.details.background}}</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.backgrounds">Abrir Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.backgrounds" data-item-type="background">Adicionar</button>
              </div>
            </div>
            <div class="item-row">
              <span class="item-name">Classe: {{system.details.class}}</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.classes">Abrir Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.classes" data-item-type="class">Adicionar</button>
              </div>
            </div>
          </div>
        </section>
      </div>

      {{#if isCharacter}}
      <div class="tab-panel tab-criacao">
        <section class="panel wizard-panel">
          <h3>Wizard de Criacao</h3>

          <div class="wizard-progress">
            <div class="wizard-progress-bar" style="width: {{wizard.progress}}%;"></div>
          </div>
          <div class="wizard-progress-text">Etapa {{wizard.step}} de {{wizard.total}}</div>

          <div class="wizard-steps">
            <button type="button" data-action="wizard-go-step" data-step="1">1. Base</button>
            <button type="button" data-action="wizard-go-step" data-step="2">2. Ancestralidade</button>
            <button type="button" data-action="wizard-go-step" data-step="3">3. Antecedente</button>
            <button type="button" data-action="wizard-go-step" data-step="4">4. Classe</button>
            <button type="button" data-action="wizard-go-step" data-step="5">5. Finalizar</button>
          </div>

          {{#ifEq wizard.step 1}}
          <div class="wizard-step-panel">
            <h4>Passo 1: Base</h4>
            <p>Defina os dados iniciais do personagem.</p>
            <div class="stats">
              <label>Nome</label>
              <input name="name" type="text" value="{{actor.name}}" />
              <label>Nivel</label>
              <input name="system.attributes.level" type="number" value="{{system.attributes.level}}" />
            </div>
          </div>
          {{/ifEq}}

          {{#ifEq wizard.step 2}}
          <div class="wizard-step-panel">
            <h4>Passo 2: Ancestralidade</h4>
            <p>Escolha uma ancestralidade no compendio.</p>
            <div class="wizard-actions">
              <button type="button" data-action="open-compendium" data-pack="pandorha.ancestries">Abrir Compendio</button>
              <button type="button" data-action="add-from-pack" data-pack="pandorha.ancestries" data-item-type="ancestry" data-next-step="3">Selecionar</button>
            </div>
            <div class="wizard-selected">Atual: {{system.details.ancestry}}</div>
          </div>
          {{/ifEq}}

          {{#ifEq wizard.step 3}}
          <div class="wizard-step-panel">
            <h4>Passo 3: Antecedente</h4>
            <p>Escolha um antecedente no compendio.</p>
            <div class="wizard-actions">
              <button type="button" data-action="open-compendium" data-pack="pandorha.backgrounds">Abrir Compendio</button>
              <button type="button" data-action="add-from-pack" data-pack="pandorha.backgrounds" data-item-type="background" data-next-step="4">Selecionar</button>
            </div>
            <div class="wizard-selected">Atual: {{system.details.background}}</div>
          </div>
          {{/ifEq}}

          {{#ifEq wizard.step 4}}
          <div class="wizard-step-panel">
            <h4>Passo 4: Classe</h4>
            <p>Escolha uma classe no compendio.</p>
            <div class="wizard-actions">
              <button type="button" data-action="open-compendium" data-pack="pandorha.classes">Abrir Compendio</button>
              <button type="button" data-action="add-from-pack" data-pack="pandorha.classes" data-item-type="class" data-next-step="5">Selecionar</button>
            </div>
            <div class="wizard-selected">Atual: {{system.details.class}}</div>
          </div>
          {{/ifEq}}

          {{#ifEq wizard.step 5}}
          <div class="wizard-step-panel">
            <h4>Passo 5: Revisao</h4>
            <p>Confira os dados da origem e conclua.</p>
            <ul class="wizard-summary">
              <li><strong>Nome:</strong> {{actor.name}}</li>
              <li><strong>Nivel:</strong> {{system.attributes.level}}</li>
              <li><strong>Ancestralidade:</strong> {{system.details.ancestry}}</li>
              <li><strong>Antecedente:</strong> {{system.details.background}}</li>
              <li><strong>Classe:</strong> {{system.details.class}}</li>
            </ul>
            <button type="button" data-action="wizard-finish">Concluir e Ir para Base</button>
          </div>
          {{/ifEq}}

          <div class="wizard-nav">
            <button type="button" data-action="wizard-prev" {{#ifEq wizard.step 1}}disabled{{/ifEq}}>Anterior</button>
            <button type="button" data-action="wizard-next" {{#ifEq wizard.step 5}}disabled{{/ifEq}}>Proximo</button>
          </div>
        </section>
      </div>
      {{/if}}

      <div class="tab-panel tab-pericias">
        <section class="panel">
          <h3>Perícias</h3>
          <div class="item-list">
            {{#each skills}}
            <div class="item-row">
              <span class="item-name">{{label}}</span>
              <div class="item-actions">
                <label class="inline">Treinado
                  <input name="system.skills.{{id}}.trained" type="checkbox" {{#if trained}}checked{{/if}} />
                </label>
                <input name="system.skills.{{id}}.bonus" type="number" value="{{bonus}}" />
                <button type="button" data-action="roll-skill" data-skill-id="{{id}}">Rolar</button>
              </div>
            </div>
            {{/each}}
          </div>
        </section>
      </div>

      <div class="tab-panel tab-itens">
        <section class="panel">
          <h3>Itens</h3>

          <div class="item-section">
            <div class="item-header">
              <span>Armas</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.equipment">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.equipment" data-item-type="weapon">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="weapon">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.weapons}}
              <div class="item-row">
                <span class="item-name">{{name}} ({{system.weapon.damage}})</span>
                <div class="item-actions">
                  <button type="button" data-action="item-roll" data-item-id="{{_id}}">Ataque</button>
                  <button type="button" data-action="item-damage" data-item-id="{{_id}}">Dano</button>
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/each}}
            </div>
          </div>

          <div class="item-section">
            <div class="item-header">
              <span>Magias</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.spells">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.spells" data-item-type="spell">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="spell">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.spells}}
              <div class="item-row">
                <span class="item-name">{{name}} (Círculo {{system.circle}})</span>
                <div class="item-actions">
                  <button type="button" data-action="item-roll" data-item-id="{{_id}}">Ataque</button>
                  <button type="button" data-action="item-damage" data-item-id="{{_id}}">Dano</button>
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/each}}
            </div>
          </div>

          <div class="item-section">
            <div class="item-header">
              <span>Manobras</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.maneuvers">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.maneuvers" data-item-type="maneuver">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="maneuver">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.maneuvers}}
              <div class="item-row">
                <span class="item-name">{{name}}</span>
                <div class="item-actions">
                  <button type="button" data-action="item-roll" data-item-id="{{_id}}">Rolar</button>
                  <button type="button" data-action="item-damage" data-item-id="{{_id}}">Dano</button>
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/each}}
            </div>
          </div>

          <div class="item-section">
            <div class="item-header">
              <span>Características</span>
              <button type="button" data-action="item-create" data-item-type="feature">Adicionar</button>
            </div>
            <div class="item-list">
              {{#each items.features}}
              <div class="item-row">
                <span class="item-name">{{name}}</span>
                <div class="item-actions">
                  <button type="button" data-action="item-roll" data-item-id="{{_id}}">Rolar</button>
                  <button type="button" data-action="item-damage" data-item-id="{{_id}}">Dano</button>
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/each}}
            </div>
          </div>

          <div class="item-section">
            <div class="item-header">
              <span>Talentos</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.talents">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.talents" data-item-type="talent">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="talent">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.talents}}
              <div class="item-row">
                <span class="item-name">{{name}}</span>
                <div class="item-actions">
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/each}}
            </div>
          </div>

          <div class="item-section">
            <div class="item-header">
              <span>Equipamentos</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.equipment">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.equipment" data-item-type="equipment">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="equipment">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.equipment}}
              <div class="item-row">
                <span class="item-name">{{name}} ({{type}})</span>
                <div class="item-actions">
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/each}}
            </div>
          </div>

          <div class="item-section">
            <div class="item-header">
              <span>Runas</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.runes">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.runes" data-item-type="rune">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="rune">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.equipment}}
              {{#ifEq type "rune"}}
              <div class="item-row">
                <span class="item-name">{{name}}</span>
                <div class="item-actions">
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/ifEq}}
              {{/each}}
            </div>
          </div>
        </section>
      </div>

      <div class="tab-panel tab-tracos">
        <section class="panel">
          <h3>Traços</h3>
          <div class="item-section">
            <div class="item-header">
              <span>Traços</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.traits">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.traits" data-item-type="trait">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="trait">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.traits}}
              <div class="item-row">
                <span class="item-name">{{name}}</span>
                <div class="item-actions">
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/each}}
            </div>
          </div>
        </section>
      </div>

      <div class="tab-panel tab-status">
        <section class="panel">
          <h3>Condições e Efeitos</h3>

          <div class="item-section">
            <div class="item-header">
              <span>Condições</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.conditions">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.conditions" data-item-type="condition">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="condition">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.conditions}}
              <div class="item-row">
                <span class="item-name">{{name}}</span>
                <div class="item-actions">
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/each}}
            </div>
          </div>

          <div class="item-section">
            <div class="item-header">
              <span>Enfermidades</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.diseases">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.diseases" data-item-type="disease">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="disease">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.equipment}}
              {{#ifEq type "disease"}}
              <div class="item-row">
                <span class="item-name">{{name}}</span>
                <div class="item-actions">
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/ifEq}}
              {{/each}}
            </div>
          </div>

          <div class="item-section">
            <div class="item-header">
              <span>Toxinas</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.toxins">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.toxins" data-item-type="toxin">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="toxin">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.equipment}}
              {{#ifEq type "toxin"}}
              <div class="item-row">
                <span class="item-name">{{name}}</span>
                <div class="item-actions">
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/ifEq}}
              {{/each}}
            </div>
          </div>
        </section>
      </div>

      {{#if isMonster}}
      <div class="tab-panel tab-monstro">
        <section class="panel">
          <h3>Habilidades de Monstros</h3>
          <div class="item-section">
            <div class="item-header">
              <span>Habilidades</span>
              <div class="item-actions">
                <button type="button" data-action="open-compendium" data-pack="pandorha.monster-abilities">Compêndio</button>
                <button type="button" data-action="add-from-pack" data-pack="pandorha.monster-abilities" data-item-type="ability">Adicionar</button>
                <button type="button" data-action="item-create" data-item-type="ability">Criar</button>
              </div>
            </div>
            <div class="item-list">
              {{#each items.features}}
              <div class="item-row">
                <span class="item-name">{{name}}</span>
                <div class="item-actions">
                  <button type="button" data-action="item-roll" data-item-id="{{_id}}">Rolar</button>
                  <button type="button" data-action="item-damage" data-item-id="{{_id}}">Dano</button>
                  <button type="button" data-action="item-edit" data-item-id="{{_id}}">Editar</button>
                  <button type="button" data-action="item-delete" data-item-id="{{_id}}">Remover</button>
                </div>
              </div>
              {{/each}}
            </div>
          </div>
        </section>
      </div>
      {{/if}}

      <div class="tab-panel tab-descricao">
        <section class="panel">
          <h3>Descrição</h3>
          {{editor system.details.biography target="system.details.biography" button=true editable=editable}}
        </section>
      </div>
    </div>
  </nav>
</form>

